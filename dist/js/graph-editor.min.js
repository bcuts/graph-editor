"use strict";!function(t,e){"function"==typeof define&&define.amd?define(["jquery","d3"],e):"object"==typeof module&&module.exports?module.exports=e(require("jquery"),require("d3")):t.ge=e(t.jQuery,t.d3)}(this,function(t,e){var i={},n=i;return n.GraphEditor=function(i,s,r){return i.select||(i=e.select(i)),this.initOptions(r,i).initMarkers(i).initSvg(i).initData(s).initState(),this.dispatch=e.dispatch("node-click","link-click","new-link-start","new-link-end","new-link-cancel","click","simulation-start","simulation-stop"),this.bbox=[[0,0],[0,0]],this.zoom=this.zoomEvents(e.zoom()).scaleExtent([this.options.scale.min,this.options.scale.max]),this.drag=this.dragEvents(e.drag()),this.svg.call(this.zoom),this.onresize=n.bind(this,this.resized),t(window).on("resize",this.onresize),this.updateBBox(),setTimeout(n.bind(this,function(){this.update().resized().simulation(this.options.simulation.start)}),10),this},n.id=function(t){return t&&t.id||null},n.bind=function(t,e){return function(){return e.apply(t,arguments)}},n.sincos=function(t){return t*=Math.PI/180,[Math.sin(t),Math.cos(t)]},n.equal=function(t,e,i){i=i||1e-5;var n=function(t,e){return Math.abs(t-e)<i};if(null===t||null===e||void 0===t||void 0===e||"number"==typeof t&&Array.isArray(e)||"number"==typeof e&&Array.isArray(t))return!1;if("number"==typeof t&&"number"==typeof e)return n(t,e);if(!Array.isArray(t)||!Array.isArray(e))throw new Error("ge.equal: invalid argument type: ".concat(t.toString()," ",e.toString()));if(t.length!==e.length)return!1;for(var s=0;s<t.length;++s)if(!n(t[s],e[s]))return!1;return!0},n.defaultExportNode=function(t){return{id:t.id,x:t.x-this.bbox[0][0],y:t.y-this.bbox[0][1],size:t.size,title:t.title,data:t.data}},n.defaultExportLink=function(t){return{source:t.source.id,target:t.target.id,size:t.size,title:t.title,data:t.data}},n.defaultLinkPath=function(t){var e,i,n,s;if(t.source===t.target){var r=this.options.link.arc,o=t.source.size+t.size;return e=t.source.x+r.start[1]*t.source.size,i=t.source.y-r.start[0]*t.source.size,n=t.source.x+r.end[1]*o,s=t.source.y-r.end[0]*o,t.textPath="".concat("M",e,",",i,"A",t.source.size,",",t.source.size,",0,1,0,",n,",",s),t.path=t.textPath,t.flip=0,t.textPath}e=t.source.x,i=t.source.y,n=t.target.x-e,s=t.target.y-i;var a=Math.sqrt(n*n+s*s);return n/=a,s/=a,a-=t.source.size+t.target.size+t.size,e+=n*t.source.size,i+=s*t.source.size,n=e+n*a,s=i+s*a,t.path="".concat("M",e,",",i,"L",n,",",s),(t.flip=+(e>n))?t.textPath="".concat("M",n,",",s,"L",e,",",i):t.textPath=t.path,t.textPath},n.defaultSimulation=function(t,i,n){t||(t=e.forceSimulation().force("charge",e.forceManyBody()).force("link",e.forceLink()).force("center",e.forceCenter()));var s=10*e.max(i,function(t){return t.size}),r=e.mean(i,function(t){return t.x}),o=e.mean(i,function(t){return t.y});return t.nodes(i),t.force("center").x(r).y(o),t.force("link").links(n).distance(s),t},n.GraphEditor.prototype.isLinkData=function(t){return void 0!==t.source},n.GraphEditor.prototype.getElement=function(t){return null===t?null:t.select?t:t instanceof SVGElement?e.select(t):("object"!=typeof t&&(t=this.nodeById[t]||this.linkById[t]),t?this.svg.select(t.selector):null)},n.GraphEditor.prototype.getData=function(t){return null===t?null:t.select?t.datum():t instanceof SVGElement?e.select(t).datum():"object"!=typeof t?this.nodeById[t]||this.linkById[t]:t},n.GraphEditor.prototype.addNode=function(t,e){return this.initNode(t)?(this.data.nodes.push(t),e||this.update(),t):null},n.GraphEditor.prototype.addLink=function(t,e){return this.initLink(t)?(this.data.links.push(t),e||this.update(),t):null},n.GraphEditor.prototype.addNodes=function(t,e){var i=t.filter(n.bind(this,this.initNode));return this.data.nodes.push.apply(this.data.nodes,i),e||this.update(),i},n.GraphEditor.prototype.addLinks=function(t,e){var i=t.filter(n.bind(this,this.initLink));return this.data.links.push.apply(this.data.links,i),e||this.update(),i},n.GraphEditor.prototype.add=function(t,e){var i=this;if(Array.isArray(t)){var n=[],s=[];return t.forEach(function(t){i.isLinkData(t)?i.initLink(t)&&s.push(t):i.initNode(t)&&n.push(t)}),i.data.nodes.push.apply(i.data.nodes,n),i.data.links.push.apply(i.data.links,s),e||i.update(),[n,s]}return t=i.getData(t),i.isLinkData(t)?i.addLink(t,e):this.addNode(t,e)},n.GraphEditor.prototype._removeLink=function(t){this.state.selectedLink===this.data.links[t]&&this.selectLink(null),delete this.linkById[this.data.links[t].id],this.data.links.splice(t,1)},n.GraphEditor.prototype.removeLink=function(t,e){if(!(t=this.getData(t)))return!1;var i=this.data.links.indexOf(t);return i<0?(console.error("removeLink",t,"indexOf() < 0"),!1):(this._removeLink(i),e||this.update(),!0)},n.GraphEditor.prototype.removeNode=function(t,e){if(!(t=this.getData(t)))return!1;var i=this.data.nodes.indexOf(t);if(i<0)return console.error("removeNode",t," indexOf() < 0"),!1;this.state.selectedNode===t&&this.selectNode(null),this.data.nodes.splice(i,1),delete this.nodeById[t.id],i=0;for(var n=this.data.links;i<n.length;)n[i].source===t||n[i].target===t?this._removeLink(i):++i;return e||this.update(),!0},n.GraphEditor.prototype._remove=function(t,e){return t=this.getData(t),this.isLinkData(t)?this.removeLink(t,e):this.removeNode(t,e)},n.GraphEditor.prototype.remove=function(t,e){var i=this;return Array.isArray(t)?(t.forEach(function(t){i._remove(t,!0)}),void(e||i.update())):i._remove(t,e)},n.GraphEditor.prototype.selectNode=function(t,e){if(void 0===t)return this.state.selectedNode;if(t=this.getData(t),this.state.selectedNode===t&&!e)return this;var i=this.options.css.selection.node;if(this.state.selectedNode=t,!t)return this.svg.classed(i,!1),this.nodes.classed(i,!1),this.links.classed(i,!1),this;var n,s=function(e){return e===t};return n=this.options.directed?function(e){return e.source===t}:function(e){return e.source===t||e.target===t},this.svg.classed(i,!0),this.nodes.classed(i,s),this.links.classed(i,n),this.nodes.filter(s).raise(),this.links.filter(n).raise(),this},n.GraphEditor.prototype.selectLink=function(t,e){if(void 0===t)return this.state.selectedLink;if(t=this.getData(t),this.state.selectedLink===t&&!e)return this;var i=this.options.css.selection.link;if(this.state.selectedLink=t,!t)return this.svg.classed(i,!1),this.links.classed(i,!1),this;var n=function(e){return e===t};return this.svg.classed(i,!0),this.links.classed(i,n),this.links.filter(n).raise(),this},n.GraphEditor.prototype.select=function(t,e){return void 0===t?{node:this.state.selectedNode,link:this.state.selectedLink}:null===t?this.selectNode(null).selectLink(null):(t=this.getData(t))?this.isLinkData(t)?this.selectLink(t,e):this.selectNode(t,e):this},n.GraphEditor.prototype.startSimulation=function(t){var e=this;if(void 0===t&&(t=this.options.simulation.stop),this.state.simulationStarted)return t?this.state.simulation.on("end",function(){e.stopSimulation()}):this.state.simulation.on("end",null),this;this.state.simulationStarted=!0,this.state.simulation=this.options.simulation.create.call(this,this.state.simulation,this.data.nodes,this.data.links);var i=0;return this.state.simulation.on("tick",function(){++i>=e.options.simulation.step&&(i=0,e.update(!0))}),t?this.state.simulation.on("end",function(){e.stopSimulation()}):this.state.simulation.on("end",null),this.state.simulation.alpha(1).restart(),this.dispatch.call("simulation-start",this),this},n.GraphEditor.prototype.stopSimulation=function(){return this.state.simulationStarted?(this.state.simulation.stop(),this.state.simulationStarted=!1,this.dispatch.call("simulation-stop",this),this):this},n.GraphEditor.prototype.simulation=function(t){return void 0===t?this.state.simulationStarted:"restart"===t?this.state.simulationStarted?(this.state.simulation.alpha(1).restart(),this):this.startSimulation():("toggle"===t&&(t=!this.state.simulationStarted),t&&"stop"!==t?this.startSimulation():this.stopSimulation())},n.GraphEditor.prototype.dragToLink=function(t){return void 0===t?this.state.dragToLink:("toggle"===t&&(t=!this.state.dragToLink),this.state.dragToLink=t,this)},n.GraphEditor.prototype.clear=function(t){return t=t||void 0===t,this.simulation(!1),this.nodes=this.nodes.data([],n.id),this.nodes.exit().remove(),this.links=this.links.data([],n.id),this.links.exit().remove(),this.defs=this.defs.data([],n.id),this.defs.exit().remove(),t&&(this.nodeById={},this.linkById={},this.data={nodes:[],links:[]},this.initState()),this},n.GraphEditor.prototype.redraw=function(){return this.clear(!1).update()},n.GraphEditor.prototype.destroy=function(){var e=this.options.css;return t(window).off("resize",this.onresize),this.clear(),this.svg.classed(e.graph,!1).classed(e.digraph,!1).classed(e.selection.node,!1).classed(e.selection.link,!1).on(".zoom",null).html(""),this},n.GraphEditor.prototype.exportData=function(){var t=this.options.export;return{nodes:this.data.nodes.map(n.bind(this,t.node)),links:this.data.links.map(n.bind(this,t.link))}},n.GraphEditor.prototype.on=function(t,e){return this.dispatch.on(t,e),this},n.GraphEditor.prototype.clickPosition=function(t){return t=t||this.container.node(),e.touch(t)||e.mouse(t)},n.GraphEditor.prototype.touchedNode=function(){for(var t=e.event.touches[0].pageX,i=e.event.touches[0].pageY,n=document.elementFromPoint(t,i),s=this.options.css.node;;){if(!n)return null;switch(n.tagName.toLowerCase()){case"svg":case"body":return null;case"g":if(n.classList.contains(s))return e.select(n).datum()}n=n.parentNode}},n.GraphEditor.prototype.dragEvents=function(t){var i=this;return t.on("start",function(t){i.state.dragged=!1,i.state.dragPos=null,e.select(this).raise(),i.state.simulationStarted&&!i.state.dragToLink&&(t.fx=t.x,t.fy=t.y,i.simulation("restart"))}).on("drag",function(t){if(i.state.dragToLink){var n=i.clickPosition(),s="".concat("M",t.x,",",t.y,"L",n[0],",",n[1]);i.state.dragged?i.transition(i.dragLine,"drag").attr("d",s):(i.state.dragged=!0,i.dragLine.classed(i.options.css.hide,!1).attr("d",s),i.dispatch.call("new-link-start",i,t))}else i.state.dragged=!0,t.x+=e.event.dx,t.y+=e.event.dy,i.state.simulationStarted&&(t.fx=t.x,t.fy=t.y,i.simulation("restart")),i.updateNode(this)}).on("end",function(t){if(t.fx=null,t.fy=null,i.state.dragPos=i.clickPosition(),i.state.dragged)if(i.state.dragged=!1,i.state.dragToLink)if(i.dragLine.classed(i.options.css.hide,!0),i.state.newLinkTarget){var e=i.state.newLinkTarget;i.state.newLinkTarget=null,i.dispatch.call("new-link-end",i,t,e)}else i.dispatch.call("new-link-cancel",i,t);else i.state.simulationStarted&&i.simulation("restart");else i.dispatch.call("node-click",i,t)})},n.GraphEditor.prototype.zoomEvents=function(t){var i=this;return t.duration(i.options.transition.zoom).on("end",function(){if(!i.state.zoomed){var t=i.clickPosition();n.equal(i.state.dragPos,t)?i.state.dragPos=null:i.dispatch.call("click",i,t)}i.state.zoomed=!1}).on("zoom",function(){i.state.zoomed=!0;var t;n.equal(e.event.transform.k,i.state.zoom)?t="drag":(t="zoom",i.state.zoom=e.event.transform.k),i.transition(i.container,t,"zoom").attr("transform",e.event.transform.toString())})},n.GraphEditor.prototype.linkEvents=function(t){var i=this;return t.on("mousedown",function(){e.event.stopPropagation(),e.event.preventDefault()}).on("touchstart",function(){i.state.dragPos=i.clickPosition()}).on("mouseup",function(t){e.event.stopPropagation(),e.event.preventDefault(),i.dispatch.call("link-click",i,t)})},n.GraphEditor.prototype.nodeEvents=function(t){var e=this;return t.attr("transform",function(t){return"translate(".concat(t.x,",",t.y,")")}).on("mouseover",function(t){e.state.dragToLink&&(e.state.newLinkTarget=t)}).on("mouseout",function(){e.state.dragToLink&&(e.state.newLinkTarget=null)}).on("touchmove",function(){e.state.dragToLink&&(e.state.newLinkTarget=e.touchedNode())}).call(e.drag)},n.GraphEditor.prototype.initMarkers=function(t){var e=t.append("svg:defs"),i=["ge-arrow-default","ge-arrow-hover","ge-arrow-selected","ge-arrow-selected-hover","ge-arrow-unselected","ge-arrow-unselected-hover","ge-arrow-selected-node","ge-arrow-selected-node-hover","ge-dragline-end"];return e.selectAll("marker").data(i).enter().append("marker").attr("id",function(t){return t}).attr("viewBox","0 -7 12 14").attr("refX","7").attr("refY","0").attr("markerWidth",3.5).attr("markerHeight",3.5).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5Z"),e.append("marker").attr("id","ge-dragline-start").attr("viewBox","-5 -5 5 5").attr("refX",-2).attr("refY",-2).attr("markerWidth",4).attr("markerHeight",4).append("circle").attr("r",2).attr("cx",-2).attr("cy",-2),this},n.GraphEditor.prototype.initSvg=function(t){t.attr("id",this.options.id).classed(this.options.css.graph,!0).classed(this.options.css.digraph,this.options.directed);var e=t.append("g"),i=t.select("defs"),n=e.append("g"),s=e.append("g");return this.container=e,this.defs=i.selectAll(".ge-text-path"),this.links=n.selectAll("g"),this.nodes=s.selectAll("g"),this.dragLine=e.append("path").classed(this.options.css.dragline,!0).classed(this.options.css.hide,!0).attr("d","M0,0L0,0"),this.tmpText=t.append("text").style("stroke","none").style("fill","none"),this.svg=t,this},n.GraphEditor.prototype.initData=function(t){return this.nodeById={},this.linkById={},this.data={nodes:[],links:[]},this.addNodes(t.nodes,!0),this.addLinks(t.links,!0),this},n.GraphEditor.prototype.initState=function(){return this.state={zoomed:!1,dragged:!1,simulation:null,simulationStarted:!1,dragToLink:!1,newLinkTarget:null,selectedNode:null,selectedLink:null,dragPos:null,zoom:1},this},n.GraphEditor.prototype.initNode=function(t){return void 0===t.id&&(t.id=1+e.max(this.data.nodes,function(t){return t.id}),isNaN(t.id)&&(t.id=0)),!this.nodeById[t.id]&&(t.elementId=this.options.id.concat("n",t.id),t.selector="#"+t.elementId,t.size=t.size||this.options.node.size.def,void 0===t.x&&(t.x=t.size+512*Math.random()),void 0===t.y&&(t.y=t.size+512*Math.random()),void 0===t.title&&(t.title=t.id.toString()),this.nodeById[t.id]=t,!0)},n.GraphEditor.prototype.initLink=function(t){var e=t.source,i=t.target;if("object"!=typeof e&&(e=this.nodeById[e]),"object"!=typeof i&&(i=this.nodeById[i]),void 0===e||void 0===i)return console.error(t,e,i),!1;t.source=e,t.target=i;var n=this.options.link.id(t);return!this.linkById[n]&&(t.id=n,t.size=t.size||this.options.link.size.def,t.defId=this.options.id.concat("d",t.id),t.pathId=this.options.id.concat("p",t.id),t.selector="#"+t.pathId,void 0===t.title&&(t.title=t.id),this.linkById[t.id]=t,!0)},n.GraphEditor.prototype.defaults={id:null,directed:!1,node:{border:2,size:{def:10,min:10},text:{dx:0,dy:0,inside:!0}},link:{path:n.defaultLinkPath,size:{def:2},text:{dx:0,dy:"1.1em",offset:null,anchor:null},arc:{start:180,end:270}},simulation:{create:n.defaultSimulation,start:!1,stop:!0,step:1},transition:{zoom:250,drag:50,simulation:50},scale:{min:.25,max:8},bbox:{padding:80},export:{node:n.defaultExportNode,link:n.defaultExportLink},css:{node:"ge-node",graph:"ge-graph",digraph:"ge-digraph",hide:"ge-hidden",dragline:"ge-dragline",link:"ge-link",selection:{node:"ge-selection",link:"ge-link-selection"}}},n.GraphEditor.prototype.typeDefaults=[{link:{id:function(t){return"".concat(Math.min(t.source.id,t.target.id),"-",Math.max(t.source.id,t.target.id))},text:{offset:"50%",anchor:"middle"}}},{link:{id:function(t){return"".concat(t.source.id,"-",t.target.id)},text:{offset:"20%",anchor:"start"}}}],n.GraphEditor.prototype.initOptions=function(e,i){var s;s=e&&e.hasOwnProperty("directed")?e.directed:this.defaults.directed;var r=this.typeDefaults[+s],o=t.extend(!0,{},this.defaults,r,e||{});o.id=o.id||i.attr("id")||"ge".concat(Math.floor(100*Math.random())),o.link.arc={start:n.sincos(Math.min(o.link.arc.start,o.link.arc.end)),end:n.sincos(Math.max(o.link.arc.start,o.link.arc.end)),center:n.sincos((o.link.arc.start+o.link.arc.end)/2)};var a=100-parseInt(o.link.text.offset)+"%";switch(o.link.text.offset=[o.link.text.offset,a],o.link.text.anchor){case"start":a="end";break;case"end":a="start";break;default:a="middle"}return o.link.text.anchor=[o.link.text.anchor,a],this.options=o,this},n.GraphEditor.prototype.transition=function(t,e,i){var n=this.options.transition[e];return n?t.transition(i).duration(n):t},n.GraphEditor.prototype.getNodeSize=function(t){if(t.title===t.prevTitle)return!1;t.prevTitle=t.title,this.tmpText.text(t.title);var e,i=this.tmpText.node().getBBox(),n=t.title.split(/\s+/);if(n.length<=1)e=i.width;else{e=Math.sqrt(i.width*i.height);for(var s,r="",o=0,a=0,d=0,h=0;h<n.length;)""===r?(r=n[h],this.tmpText.text(r),o=this.tmpText.node().getComputedTextLength(),++h):(r=r.concat(" ",n[h]),this.tmpText.text(r),(s=this.tmpText.node().getComputedTextLength())>e?(a=Math.max(a,o),++d,r=""):(o=s,++h));e=Math.max(a,o,i.height*d*1.5)}return e=Math.max(e,this.options.node.size.min),t.textSize=e,t.textSize+=t.textSize%2*2+this.options.node.border,t.textOffset=Math.floor(-t.textSize/2),t.size=t.textSize/1.4142,!0},n.GraphEditor.prototype.resized=function(){return this.updateExtent(),this.zoom.translateTo(this.container,0,0),this},n.GraphEditor.prototype.updateSimulation=function(){return this.state.simulation&&(this.state.simulation=this.options.simulation.create.call(this,this.state.simulation,this.data.nodes,this.data.links).alpha(1)),this},n.GraphEditor.prototype.updateBBox=function(t){var i=this.data.nodes,n=this.options.bbox.padding;if(void 0===t){var s=e.extent(i,function(t){return t.x});void 0===s[0]&&(s[0]=s[1]=0),this.bbox[0][0]=s[0]-n,this.bbox[1][0]=s[1]+n,void 0===(s=e.extent(i,function(t){return t.y}))[0]&&(s[0]=s[1]=0),this.bbox[0][1]=s[0]-n,this.bbox[1][1]=s[1]+n}else this.bbox[0][0]=Math.min(this.bbox[0][0],i.x-n),this.bbox[1][0]=Math.max(this.bbox[1][0],i.x+n),this.bbox[0][1]=Math.min(this.bbox[0][1],i.y-n),this.bbox[1][1]=Math.max(this.bbox[1][1],i.y+n);return this.updateExtent(),this.zoom.translateExtent(this.bbox),this},n.GraphEditor.prototype.updateExtent=function(){var t=this.svg.node().getBoundingClientRect(),e=[[0,0],[t.width,t.height]];return this.zoom.extent(e),this},n.GraphEditor.prototype.updateLink=function(t){var i=this,s=function(t){return i.transition(t,"drag","update-link")};return t=i.getElement(t),s(e.select("#"+t.datum().defId)).attr("d",n.bind(i,i.options.link.path)),s(t.select("path")).attr("d",function(t){return t.path}).style("stroke-width",function(t){return t.size+"px"}),t.select("textPath").text(function(t){return t.title}),this},n.GraphEditor.prototype.updateNode=function(t){var e,i,s=this,r=this.options,o=(t=this.getElement(t)).select("circle"),a=t.attr("transform"),d=o.attr("r"),h=function(t){return s.transition(t,"drag","update-node")};if(h(t).attr("transform",function(t){return e="translate(".concat(t.x,",",t.y,")")}),r.node.text.inside?this.getNodeSize(t.datum())&&t.select("foreignObject").attr("x",function(t){return t.textOffset}).attr("y",function(t){return t.textOffset}).attr("width",function(t){return t.textSize}).attr("height",function(t){return t.textSize}).select("span").text(function(t){return t.title}):t.select("text").attr("dx",function(t){return t.size+r.node.text.dx}).text(function(t){return t.title}),h(o).attr("r",function(t){return i=t.size}),e!==a||i!==d){t=t.datum();var l=function(e){return e.source===t||e.target===t},u=this.defs.filter(l),c=this.links.filter(l);h(u).attr("d",n.bind(this,r.link.path)),h(c.select("path")).attr("d",function(t){return t.path});var p=r.link.text.offset,f=r.link.text.anchor;h(c.select("textPath")).attr("startOffset",function(t){return p[t.flip]}).attr("text-anchor",function(t){return f[t.flip]}),this.updateBBox()}return this},n.GraphEditor.prototype.update=function(t){var e=this,i=this.options,s=t?"simulation":"drag",r=function(t){return e.transition(t,s,"update")};i.node.text.inside&&this.data.nodes.forEach(n.bind(this,this.getNodeSize)),this.defs=this.defs.data(this.data.links,n.id),this.defs.exit().remove(),this.defs=this.defs.enter().append("path").attr("id",function(t){return t.defId}).merge(this.defs),r(this.defs).attr("d",n.bind(this,i.link.path)),this.links=this.links.data(this.data.links,n.id),this.links.exit().remove();var o=this.links.enter().append("g").attr("id",function(t){return t.pathId}).classed(i.css.link,!0);o.append("path"),o.append("text").attr("dx",i.link.text.dx).attr("dy",i.link.text.dy).append("textPath").attr("xlink:href",function(t){return"#"+t.defId}),this.links=o.merge(this.links),r(this.links.select("path")).style("stroke-width",function(t){return t.size+"px"}).attr("d",function(t){return t.path});var a=i.link.text.offset,d=i.link.text.anchor;r(this.links.select("textPath")).text(function(t){return t.title}).attr("startOffset",function(t){return a[t.flip]}).attr("text-anchor",function(t){return d[t.flip]}),this.nodes=this.nodes.data(this.data.nodes,n.id),this.nodes.exit().remove();var h=this.nodes.enter().append("g").attr("id",function(t){return t.elementId}).classed(i.css.node,!0);if(h.append("circle"),i.node.text.inside?h.append("foreignObject").append("xhtml:div").append("xhtml:span"):h.append("text"),this.nodes=h.merge(this.nodes),r(this.nodes).attr("transform",function(t){return"translate(".concat(t.x,",",t.y,")")}),i.node.text.inside){var l=this.nodes.select("foreignObject");r(l).attr("x",function(t){return t.textOffset}).attr("y",function(t){return t.textOffset}).attr("width",function(t){return t.textSize}).attr("height",function(t){return t.textSize}),r(l.selectAll("span")).text(function(t){return t.title})}else r(this.nodes.select("text")).text(function(t){return t.title}).attr("dx",function(t){return t.size+i.node.text.dx}).attr("dy",i.node.text.dy);return r(this.nodes.select("circle")).attr("r",function(t){return t.size}),this.nodeEvents(h),this.linkEvents(o),this.updateBBox(),t||(this.updateSimulation(),this.selectNode(this.state.selectedNode,!0)),this},i});
